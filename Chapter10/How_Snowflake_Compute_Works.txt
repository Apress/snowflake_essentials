/*  Create Warehouse Example
*/
CREATE WAREHOUSE "SAMPLE_QUERY_WH"
SET WAREHOUSE_SIZE = 'XSMALL' 
AUTO_SUSPEND = 300 
AUTO_RESUME = TRUE
MIN_CLUSTER_COUNT = 1
MAX_CLUSTER_COUNT = 4
SCALING_POLICY = 'STANDARD'
COMMENT = 'Sample Virtual warehouse';

/*  Create Resource Monitor Example
*/
CREATE RESOURCE MONITOR "TEST_RM" WITH CREDIT_QUOTA = 150 
 TRIGGERS 
 ON 95 PERCENT DO SUSPEND 
 ON 100 PERCENT DO SUSPEND_IMMEDIATE 
 ON 80 PERCENT DO NOTIFY;
ALTER WAREHOUSE "TEST" SET RESOURCE_MONITOR = "TEST_RM";

/*  Analyze Credits Used By Warehouse Overall
*/

SELECT WAREHOUSE_NAME, SUM(CREDITS_USED_COMPUTE) 
FROM ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY
GROUP BY 1
ORDER BY 2 DESC;

/*  Analyze Credits Used By Warehouse â€“ Last 7 Days
*/
SELECT WAREHOUSE_NAME, SUM(CREDITS_USED_COMPUTE) 
FROM ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY
WHERE START_TIME::DATE > DATEADD('DAYS', -7, CURRENT_DATE)
ORDER BY 2 DESC;

/*  Analyze Credits Used By Warehouse
*/
SELECT START_TIME, WAREHOUSE_NAME, CREDITS_USED_COMPUTE
FROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY
WHERE START_TIME >= DATEADD(DAY, -7, CURRENT_TIMESTAMP())
AND WAREHOUSE_ID > 0
ORDER BY 1 DESC 2;
